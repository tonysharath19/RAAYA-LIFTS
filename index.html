<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>RAAYA LIFTS</title>
<link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Inter:wght@300;600;800&display=swap" rel="stylesheet">
<style>
:root{--neon:#00F2FF;--warn:#FF3131;--success:#00ff88;--gold:#FFD700;--bg:#030708;--card:rgba(255,255,255,0.03);--glass:rgba(0,242,255,0.08)}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth}
body{
    background:var(--bg);
    color:#fff;
    font-family:-apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
    overflow-x:hidden;
    line-height:1.5;
    -webkit-font-smoothing: antialiased;
    text-size-adjust: 100%;
}

/* ANIMATIONS */
@keyframes fU{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
.reveal{ opacity:0; transition: all 0.8s ease-out; will-change: transform, opacity; }
.reveal.active{ opacity:1; transform:translateY(0); animation:fU .8s forwards; }

@keyframes shimmer { 0% {background-position: -200% center;} 100% {background-position: 200% center;} }
.shimmer-text { 
    background: linear-gradient(90deg, var(--neon) 20%, #fff 50%, var(--neon) 80%); 
    background-size: 200% auto; 
    -webkit-background-clip: text; 
    background-clip: text;
    color: transparent; 
    animation: shimmer 3s linear infinite; 
    font-weight: 800; 
}

.gold-shimmer { 
    background: linear-gradient(90deg, var(--gold) 20%, #fff 50%, var(--gold) 80%); 
    background-size: 200% auto; 
    -webkit-background-clip: text; 
    background-clip: text;
    color: transparent; 
    animation: shimmer 3s linear infinite; 
}

/* NAV */
nav{position:fixed;width:100%;padding:15px 5%;display:flex;justify-content:space-between;align-items:center;z-index:1000;background:rgba(3,7,8,.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px); border-bottom:1px solid rgba(0,242,255,.1)}
.logo{font-family:'Syncopate';font-size:1rem;color:#fff;border-left:3px solid var(--neon);padding-left:10px;font-weight:700;cursor:pointer}
.nav-links{display:flex;gap:20px;margin-left:auto;margin-right:30px}
.nav-links a{color:rgba(255,255,255,.6);text-decoration:none;font-size:.65rem;font-weight:600;transition:.3s;text-transform:uppercase}
.nav-links a:hover{color:var(--neon)}
.user-controls{display:flex;align-items:center;gap:15px;font-family:'Syncopate';font-size:0.7rem;font-weight:700}
.portal-btn{color:var(--neon);cursor:pointer}
.user-badge { display:none; align-items:center; gap:10px; font-size: 0.65rem; }
.upgrade-btn { background: var(--warn); color: #fff; padding: 2px 6px; font-size: 0.5rem; border-radius: 2px; cursor: pointer; animation: pulse 2s infinite; text-decoration: none;}
@keyframes pulse { 0% {opacity:1;} 50% {opacity:0.6;} 100% {opacity:1;} }
.cart-icon{width:24px;height:24px;fill:#fff;transition:0.3s;position:relative;cursor:pointer;display:none}
.cart-icon:hover{fill:var(--neon)}
.cart-count{position:absolute;top:-5px;right:-8px;background:var(--warn);color:#fff;font-size:0.5rem;width:14px;height:14px;display:flex;align-items:center;justify-content:center;border-radius:50%;font-family:'Inter'}
.logout-btn{color:var(--warn);cursor:pointer;display:none;font-size:1.2rem;line-height:1}
.hamburger{display:none;font-size:1.5rem;color:var(--neon);cursor:pointer;margin-left:15px}
.mobile-menu{position:fixed;top:60px;left:0;width:100%;background:rgba(5,10,12,0.98);padding:20px 0;display:none;flex-direction:column;text-align:center;border-bottom:1px solid var(--neon);gap:20px;z-index:999}
.mobile-menu a{color:#fff;text-decoration:none;font-family:'Syncopate';font-size:0.9rem;padding:10px}
@media(max-width:768px){ .nav-links{display:none} .hamburger{display:block} }

/* SECTIONS - DESKTOP GLASS SLIDE ENGINE */
section{padding:100px 8%;position:relative;background-size:cover;background-position:center;background-attachment:fixed;min-height:100vh;display:flex;flex-direction:column;justify-content:center}
.hero{height:100vh;display:flex;align-items:center;justify-content:center;text-align:center;padding:0 5%;background:linear-gradient(rgba(3,7,8,.5),rgba(3,7,8,.5)),url('https://images.unsplash.com/photo-1541534741688-6078c6bfb5c5?q=80&w=2069');background-size:cover;background-position:center;background-attachment:fixed}
.hero h1{font-family:'Syncopate';font-size:clamp(2.5rem,10vw,5.5rem);font-weight:700;text-shadow:0 0 25px var(--neon)}
.overlay{position:absolute;inset:0;background:rgba(3,7,8,0.7);z-index:1}
.content{position:relative;z-index:2;width:100%}
h2{font-family:'Syncopate';font-size:1.8rem;margin-bottom:40px;border-bottom:1px solid var(--neon);display:inline-block;padding-bottom:10px;text-align:center;width:100%}

/* 1. DEFAULT MOBILE BEHAVIOR (Androids get the Sliding Glass Effect) */
@media(max-width:768px){
    section, .hero { 
        /* Keep Fixed for Android to maintain the "Glass Slide" */
        background-attachment: fixed !important; 
        background-position: center center !important; 
        -webkit-background-size: cover !important; 
        background-size: cover !important;
        min-height: 100vh; 
    }
    
    .hero { background-image: linear-gradient(rgba(3,7,8,0.3),rgba(3,7,8,0.3)), url('https://images.unsplash.com/photo-1595078475328-1ab05d0a6a0e?w=600&auto=format&fit=crop&q=60') !important; }
    #crisis { background-image: url('https://images.unsplash.com/photo-1544263092-16c4dcfeb056?w=600&auto=format&fit=crop&q=60') !important; }
    #about { background-image: url('https://images.unsplash.com/photo-1637430308606-86576d8fef3c?w=600&auto=format&fit=crop&q=60') !important; }
    #membership { background-image: url('https://images.unsplash.com/photo-1629810226180-5d31f306f717?w=600&auto=format&fit=crop&q=60') !important; }
    #facilities { background-image: url('https://images.unsplash.com/photo-1550259979-ed79b48d2a30?w=600&auto=format&fit=crop&q=60') !important; }
    #vault { background-image: url('https://images.unsplash.com/photo-1587938745570-681161dcfe17?w=600&auto=format&fit=crop&q=60') !important; }
    #contact { background-image: url('https://images.unsplash.com/photo-1707524464813-78014aa12861?w=600&auto=format&fit=crop&q=60') !important; }
}

/* 2. APPLE SPECIFIC OVERRIDE (Only disable it for iPhones to fix distortion) */
@supports (-webkit-touch-callout: none) {
    @media(max-width:768px){
        section, .hero {
            /* Force SCROLL only on iOS to prevent the zoomed-in/pixelated bug */
            background-attachment: scroll !important;
        }
    }
}    
    .hero { background-image: linear-gradient(rgba(3,7,8,0.3),rgba(3,7,8,0.3)), url('https://images.unsplash.com/photo-1595078475328-1ab05d0a6a0e?w=600&auto=format&fit=crop&q=60') !important; }
    #crisis { background-image: url('https://images.unsplash.com/photo-1544263092-16c4dcfeb056?w=600&auto=format&fit=crop&q=60') !important; }
    #about { background-image: url('https://images.unsplash.com/photo-1637430308606-86576d8fef3c?w=600&auto=format&fit=crop&q=60') !important; }
    #membership { background-image: url('https://images.unsplash.com/photo-1629810226180-5d31f306f717?w=600&auto=format&fit=crop&q=60') !important; }
    #facilities { background-image: url('https://images.unsplash.com/photo-1550259979-ed79b48d2a30?w=600&auto=format&fit=crop&q=60') !important; }
    #vault { background-image: url('https://images.unsplash.com/photo-1587938745570-681161dcfe17?w=600&auto=format&fit=crop&q=60') !important; }
    #contact { background-image: url('https://images.unsplash.com/photo-1707524464813-78014aa12861?w=600&auto=format&fit=crop&q=60') !important; }


/* GRIDS */
.crisis-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}.crisis-card{background:rgba(255,49,49,.05);border:1px solid var(--warn);padding:25px;text-align:center}.crisis-card h4{color:var(--warn);font-family:'Syncopate';font-size:1.5rem}

/* MEMBERSHIP */
.mem-grid{display:grid;grid-template-columns:repeat(3, 1fr);gap:20px;align-items:stretch}
@media(max-width:900px){.mem-grid{grid-template-columns:1fr}}
.mem-card{background:var(--card);border:1px solid rgba(255,255,255,.05);padding:40px 25px;transition:.4s;position:relative;overflow:hidden;text-align:center;display:flex;flex-direction:column;justify-content:space-between}
.mem-card:hover{border-color:var(--neon);background:var(--glass);transform:translateY(-5px)}
.mem-card h3{font-family:'Syncopate';font-size:1.2rem;margin-bottom:15px;color:var(--neon)}
.price{font-size:2.8rem;font-weight:800;margin:20px 0;color:#fff}
.mem-features{text-align:left;margin:25px 0;padding:20px;background:rgba(0,0,0,.3);border-left:2px solid var(--neon);flex-grow:1}
.mem-features li{font-size:.85rem;margin:12px 0;opacity:.8;list-style:none;padding-left:20px;position:relative}
.mem-features li::before{content:'▸';position:absolute;left:0;color:var(--neon)}

/* PERKS */
.current-plan-box { background: rgba(0, 242, 255, 0.05); border: 1px solid var(--neon); padding: 30px; margin-bottom: 40px; text-align: left; }
.current-plan-box h3 { font-family: 'Syncopate'; color: var(--neon); font-size: 1.5rem; margin-bottom: 20px; }
.perk-check { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
.perk-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; opacity: 0.9; }
.perk-item span { color: var(--success); font-weight: bold; }

/* FACILITIES CAROUSEL */
.facility-wrapper { overflow-x: auto; white-space: nowrap; scroll-behavior: smooth; padding-bottom: 20px; display: flex; gap: 20px; -webkit-overflow-scrolling: touch; }
.facility-wrapper::-webkit-scrollbar { height: 5px; } .facility-wrapper::-webkit-scrollbar-thumb { background: var(--neon); }
.facility-card { flex: 0 0 300px; height: 400px; position: relative; border: 2px solid var(--neon); box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); transition: 0.4s; overflow: hidden; border-radius: 4px; background-size: cover; background-position: center; }
.facility-card:hover { transform: scale(1.02); box-shadow: 0 0 30px var(--neon); }
.f-overlay { position: absolute; inset: 0; background: linear-gradient(to top, #000 10%, transparent 80%); display: flex; flex-direction: column; justify-content: flex-end; padding: 20px; }
.f-title { font-family: 'Syncopate'; font-size: 1.2rem; color: #fff; margin-bottom: 5px; text-shadow: 0 2px 10px #000; }
.f-desc { font-size: 0.8rem; opacity: 0.8; white-space: normal; }

/* VAULT & CONTACT */
.vault-nav{display:flex;gap:10px;margin-bottom:60px;justify-content:center;flex-wrap:wrap}.cat-btn{padding:12px 25px;border:1px solid var(--neon);color:var(--neon);background:transparent;cursor:pointer;font-family:'Syncopate';font-size:.65rem;transition:.3s;text-transform:uppercase}.cat-btn.active{background:var(--neon);color:#000}
.carousel-container{width:100%;max-width:300px;margin:0 auto;height:450px;position:relative;perspective:1000px}.carousel-3d{width:100%;height:100%;position:absolute;transform-style:preserve-3d;transition:transform 1s}.vault-card{position:absolute;width:260px;height:400px;left:20px;background:linear-gradient(135deg,var(--card),rgba(0,242,255,.05));border:1px solid rgba(0,242,255,.3);padding:25px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.3);backface-visibility:hidden}.vault-img{width:100%;height:180px;background-size:cover;background-position:center;margin-bottom:20px;border-radius:8px;border:1px solid var(--neon)}.vault-card h3{font-family:'Syncopate';font-size:1rem;margin-bottom:10px;color:var(--neon)}.vault-card .price-tag{font-size:1.3rem;font-weight:800;color:#fff;margin:15px 0}.carousel-controls{display:flex;gap:20px;justify-content:center;margin-top:40px}.ctrl-btn{background:var(--neon);color:#000;border:none;padding:15px 30px;font-family:'Syncopate';font-size:.7rem;cursor:pointer;transition:.3s}.ctrl-btn:hover{box-shadow:0 0 20px var(--neon)}
.contact-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:20px}.contact-btn{background:var(--card);border:1px solid rgba(255,255,255,.1);padding:40px;text-align:center;text-decoration:none;color:#fff;transition:.3s;display:flex;flex-direction:column;align-items:center;gap:15px}.contact-btn svg{width:40px;height:40px;fill:var(--neon);transition:.3s}.contact-btn:hover{background:var(--neon);color:#000;transform:scale(1.05)}.contact-btn:hover svg{fill:#000}

/* GLOBAL UI */
.btn{background:var(--neon);color:#000;border:none;padding:15px 30px;font-family:'Syncopate';font-size:.7rem;font-weight:700;cursor:pointer;transition:.3s;width:100%;margin-top:15px}.btn:hover{box-shadow:0 0 15px var(--neon);opacity:.9}
input,select,textarea{width:100%;padding:15px;margin:10px 0;background:rgba(0,0,0,0.4);border:1px solid rgba(0,242,255,.2);color:#fff;font-family:'Inter';border-radius:3px; font-size:16px}
input:focus, select:focus, textarea:focus{border-color:var(--neon);outline:none;background:rgba(0,242,255,0.05)}
select option { background: #030708; color: #fff; }
.query-form{max-width:800px;margin:60px auto 0;background:var(--card);border:1px solid rgba(0,242,255,.1);padding:30px;border-radius:5px}.query-form h3{font-family:'Syncopate';font-size:1.2rem;color:var(--neon);margin-bottom:20px;text-align:center}.form-group{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px}.form-group.full{grid-template-columns:1fr}@media(max-width:600px){.form-group{grid-template-columns:1fr}}textarea{resize:vertical;min-height:120px}

/* FOOTER */
footer{background:#000;padding:60px 8% 30px;border-top:1px solid var(--neon)}.footer-grid{display:grid;grid-template-columns:repeat(4, 1fr);gap:20px;margin-bottom:40px;text-align:center}@media(max-width:768px){.footer-grid{grid-template-columns:1fr;text-align:center !important}}
.footer-col h4{font-family:'Syncopate';color:var(--neon);margin-bottom:20px;font-size:.9rem}.footer-col ul{list-style:none}.footer-col ul li{margin:10px 0;opacity:.7;font-size:.85rem}.footer-bottom{text-align:center;padding-top:30px;border-top:1px solid rgba(255,255,255,.1);font-size:.75rem;opacity:.5}

/* MODALS */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(3,7,8,.98);z-index:2000;place-items:center;padding:20px;backdrop-filter:blur(10px)}
.modal-box{background:#050a0f;padding:40px;border:1px solid var(--neon);width:100%;max-width:450px;text-align:center;box-shadow:0 0 40px rgba(0,242,255,0.1);position:relative;max-height:90vh;overflow-y:auto}
.close-modal{position:absolute;top:10px;right:15px;color:var(--warn);cursor:pointer;font-size:1.5rem}
.pwd-strength{height:4px;width:100%;background:#333;margin-top:5px;display:flex}.pwd-bar{height:100%;width:0%;transition:0.3s}.pwd-text{font-size:0.6rem;text-align:right;margin-top:5px;opacity:0.7}
.cart-item{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #333;font-size:0.8rem}
.status-track{display:flex;justify-content:space-between;margin:30px 0;position:relative}
.status-track::before{content:'';position:absolute;top:50%;left:0;width:100%;height:2px;background:#333;z-index:0}
.step{position:relative;z-index:1;background:#000;border:1px solid #333;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.6rem}
.step.active{border-color:var(--success);background:var(--success);color:#000;box-shadow:0 0 10px var(--success)}
.step-label{position:absolute;top:40px;font-size:0.6rem;width:80px;margin-left:-25px;text-align:center;opacity:0.5}
.step.active + .step-label{opacity:1;color:var(--success)}
</style>
</head>
<body>

<nav>
    <div class="logo" onclick="window.scrollTo({top:0, behavior:'smooth'})">RAAYA LIFTS</div>
    <div class="nav-links">
        <a href="#about">Origins</a>
        <a href="#membership">Access</a>
        <a href="#facilities">Facilities</a>
        <a href="#vault">Vault</a>
        <a href="#contact">Contact</a>
    </div>
    <div class="user-controls">
        <span class="portal-btn" id="portalBtn" onclick="openAuth()">PORTAL</span>
        <div class="user-badge" id="userBadge">
            <span id="userNameDisplay">PLAYER</span> | <span id="userTierDisplay">GUEST</span>
            <a href="#membership" class="upgrade-btn" id="upgradeBadge" style="display:none">[UPGRADE]</a>
        </div>
        <div class="cart-icon" id="cartBtn" onclick="openCart()">
            <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
            <span class="cart-count" id="cartCount">0</span>
        </div>
        <span class="logout-btn" id="logoutBtn" onclick="handleLogout()">⏻</span>
        <div class="hamburger" onclick="toggleMenu()">☰</div>
    </div>
</nav>

<div class="mobile-menu" id="mobileMenu">
    <a href="#about" onclick="toggleMenu()">Origins</a>
    <a href="#membership" onclick="toggleMenu()">Access</a>
    <a href="#facilities" onclick="toggleMenu()">Facilities</a>
    <a href="#vault" onclick="toggleMenu()">Vault</a>
    <a href="#contact" onclick="toggleMenu()">Contact</a>
</div>

<header class="hero">
<div class="reveal active">
<p style="font-size:.7rem;letter-spacing:5px;color:var(--neon);margin-bottom:10px">PROTOCOL: ALPHA</p>
<h1>RAAYA LIFTS</h1>
<p style="font-weight:300;opacity:.7">BEYOND HUMAN LIMITS.</p>
</div>
</header>

<section id="crisis" style="background-image:url('https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070')">
<div class="overlay"></div><div class="content reveal">
<h2>GLOBAL HEALTH ALERT</h2>
<div class="crisis-grid">
    <div class="crisis-card"><h4 id="count-obesity">0%</h4><p>World Obesity Rate</p></div>
    <div class="crisis-card"><h4 id="count-cardiac">0.0M</h4><p>Annual Cardiac Deaths</p></div>
    <div class="crisis-card"><h4 id="count-sedentary">Low</h4><p>Sedentary Mortality</p></div>
</div>
<p style="margin-top:30px;font-weight:800;text-align:center;color:#fff;letter-spacing:2px">THE WORLD IS DECAYING. RECLAIM YOUR BIOLOGY NOW.</p>
</div>
</section>

<section id="about" style="background-image:url('https://images.unsplash.com/photo-1623874514711-0f321325f318?w=1600&auto=format&fit=crop&q=80')">
<div class="overlay"></div><div class="content reveal">
<h2>ORIGINS</h2>
<div style="max-width:900px;margin:0 auto;text-align:center">
<p style="font-size:1.1rem;line-height:2;margin-bottom:30px">Founded in 2026 by elite biomechanics engineers, RAAYA LIFTS emerged from a classified human performance research project.</p>
<p style="font-size:1rem;line-height:1.9">This isn't a gym—it's a laboratory for human excellence.</p>
</div>
</div>
</section>

<section id="membership" style="background-image:url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?q=80&w=2070')">
<div class="overlay"></div><div class="content reveal">
<h2>ACCESS LEVELS</h2>
<div id="currentPlanContainer"></div>
<div class="mem-grid" id="membershipGrid">
    <div style="text-align:center;width:100%;color:var(--neon)">LOADING PROTOCOLS...</div>
</div>
</div>
</section>

<section id="facilities" style="background-image:url('https://images.unsplash.com/photo-1587938745570-681161dcfe17?q=80&w=2070')">
<div class="overlay"></div>
<div class="content reveal">
    <h2>FACILITIES</h2>
    <div class="facility-wrapper" id="facilityWrapper">
        <div style="padding:20px;color:var(--neon)">LOADING ASSETS...</div>
    </div>
</div>
</section>

<section id="vault" style="background-image:url('https://images.unsplash.com/photo-1629339837617-7069ce9e7f6b?w=1600&auto=format&fit=crop&q=80')">
<div class="overlay"></div><div class="content reveal">
<h2>THE VAULT</h2>
<div class="vault-nav"><button class="cat-btn active" data-cat="supplements">SUPPLEMENTS</button><button class="cat-btn" data-cat="gear">GEAR</button><button class="cat-btn" data-cat="apparel">APPAREL</button></div>
<div class="carousel-container"><div class="carousel-3d" id="vaultCarousel"></div></div>
<div class="carousel-controls"><button class="ctrl-btn" id="prevBtn">◄ PREV</button><button class="ctrl-btn" id="nextBtn">NEXT ►</button></div>
</div>
</section>

<section id="contact" style="background-image:url('https://images.unsplash.com/photo-1552072092-7f9b8d63efcb?q=80&w=2070')">
<div class="overlay"></div><div class="content reveal">
<h2>COMMS LINK</h2>
<div class="contact-grid">
    <a href="tel:+919100000000" class="contact-btn">
        <svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>PHONE
    </a>
    <a href="mailto:sharthkumar@raaya.com" class="contact-btn">
        <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>EMAIL
    </a>
    <a href="https://wa.me/919100000000" class="contact-btn">
        <svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
        WHATSAPP
    </a>
    <a href="https://instagram.com/raayalifts" class="contact-btn" target="_blank">
        <svg viewBox="0 0 24 24">
            <path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z"/>
        </svg>
        INSTAGRAM
    </a>
</div>
<form class="query-form" id="contactForm">
<h3>HAVE A QUESTION?</h3>
<div class="form-group"><input type="text" name="name" placeholder="Name" required><input type="email" name="email" placeholder="Email" required></div>
<div class="form-group"><input type="tel" name="phone" placeholder="Phone Number" required><select name="gender" required><option value="" disabled selected>Gender</option><option value="male">Male</option><option value="female">Female</option><option value="other">Other</option></select></div>
<div class="form-group full"><textarea name="question" placeholder="Ask us anything..." required></textarea></div>
<button type="submit" class="btn">SUBMIT QUERY</button>
</form>
</div>
</section>

<footer>
<div class="footer-grid">
<div class="footer-col"><h4>RAAYA LIFTS</h4><ul><li>Industrial Complex, Sector 7</li><li>Chennai, Tamil Nadu</li></ul></div>
<div class="footer-col"><h4>QUICK ACCESS</h4><ul><li>Membership Plans</li><li>Training Programs</li></ul></div>
<div class="footer-col"><h4>PROTOCOLS</h4><ul><li>Privacy Policy</li><li>Terms of Service</li></ul></div>
<div class="footer-col"><h4>CONNECT</h4><ul><li>Instagram: @raayalifts</li><li>Email: info@raaya.com</li></ul></div>
</div>
<div class="footer-bottom"><p>© 2026 RAAYA LIFTS. ALL RIGHTS RESERVED. | ENGINEERED FOR EXCELLENCE.</p></div>
</footer>

<div id="authModal" class="modal-overlay">
<div class="modal-box">
<span class="close-modal" onclick="closeAuth()">×</span>
<h2 id="mTitle" style="font-size:1.2rem;margin-bottom:20px">LOGIN</h2>
<div id="signupFields" style="display:none">
    <input type="text" id="suName" placeholder="Full Name">
    <div style="display:grid;grid-template-columns:1fr 2fr;gap:10px">
        <input type="number" id="suAge" placeholder="Age">
        <input type="tel" id="suPhone" placeholder="Phone">
    </div>
</div>
<input type="email" id="email" placeholder="Email">
<input type="password" id="pass" placeholder="Password" onkeyup="checkStrength(this.value)">
<div class="pwd-strength" id="pwdMeter" style="display:none"><div class="pwd-bar" id="pwdBar"></div></div>
<div class="pwd-text" id="pwdText"></div>
<button class="btn" id="authBtn">LOGIN</button>
<p id="toggleAuth" style="margin-top:20px;font-size:.7rem;color:var(--neon);cursor:pointer">New here? Create Account</p>
</div>
</div>

<div id="msgModal" class="modal-overlay">
<div class="modal-box">
<h2 style="font-size:1.2rem;color:var(--neon)" id="msgTitle">ALERT</h2>
<p id="msgBody" style="margin:20px 0;font-size:0.9rem;line-height:1.6"></p>
<button class="btn" onclick="document.getElementById('msgModal').style.display='none'">ACKNOWLEDGE</button>
</div>
</div>

<div id="cartModal" class="modal-overlay">
<div class="modal-box">
<span class="close-modal" onclick="document.getElementById('cartModal').style.display='none'">×</span>
<h2 style="font-size:1.2rem;margin-bottom:20px">CART LINK</h2>
<div id="cartItems" style="max-height:200px;overflow-y:auto;margin-bottom:20px;text-align:left"></div>
<div style="border-top:1px solid #333;padding-top:10px;text-align:right">TOTAL: <span id="cartTotal" style="color:var(--neon);font-weight:700">₹0</span></div>
<button class="btn" onclick="openPay()">PROCEED TO CHECKOUT</button>
</div>
</div>

<div id="payModal" class="modal-overlay">
<div class="modal-box">
<span class="close-modal" onclick="document.getElementById('payModal').style.display='none'">×</span>
<h2 style="font-size:1.2rem;margin-bottom:10px">PAYMENT GATEWAY</h2>
<p style="color:var(--warn);font-size:0.7rem;margin-bottom:20px">[ FAKE PAYMENT PAGE - SIMULATION ONLY ]</p>
<div id="payForm">
<input type="text" placeholder="Card Number (XXXX-XXXX-XXXX-XXXX)">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><input type="text" placeholder="MM/YY"><input type="text" placeholder="CVV"></div>
<button class="btn" onclick="processPay()">AUTHORIZE PAYMENT</button>
</div>
<div id="tracker" style="display:none">
<h3 style="color:var(--success);font-size:1rem;margin-bottom:20px">ORDER CONFIRMED</h3>
<div class="status-track">
<div class="step active"><span class="step-label">PACKED</span>1</div>
<div class="step active"><span class="step-label">SHIPPED</span>2</div>
<div class="step"><span class="step-label">TRANSIT</span>3</div>
<div class="step"><span class="step-label">DELIVERED</span>4</div>
</div>
<p style="font-size:0.8rem;margin-top:40px;color:#aaa">Your gear has been dispatched to the courier facility.</p>
</div>
</div>
</div>

<script type="module">
import{createClient}from'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
const sb=createClient('https://rpgygmrhkmevhneebbxo.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwZ3lnbXJoa21ldmhuZWViYnhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzOTkzNDYsImV4cCI6MjA4Mzk3NTM0Nn0.Haf3zKhLVzW_uBWckv_O2pdfYABWaDiExP1Kwckjrpc')

let user=null,cart=[],isSignUp=false;
let pendingMembership = null;
let statsRun = false;
let products = { supplements:[], gear:[], apparel:[] }; 

// --- HELPERS ---
function toggleMenu() {
    const menu = document.getElementById('mobileMenu');
    menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
}
window.toggleMenu = toggleMenu;

function updateMembershipUI(tier, daysLeft = null) {
    const box = document.getElementById('currentPlanContainer');
    const sCard = document.getElementById('card-standard');
    const pCard = document.getElementById('card-premium');
    const eCard = document.getElementById('card-elite');
    
    // 1. Reset Visibility (Show all by default)
    if(sCard) sCard.style.display = 'flex'; 
    if(pCard) pCard.style.display = 'flex'; 
    if(eCard) eCard.style.display = 'flex';
    
    if(!box) return;
    box.innerHTML = ''; 

    // 2. Logic: Days Left Badge
    let renewalHTML = '';
    if (daysLeft !== null && tier !== 'Guest') {
        const color = daysLeft < 5 ? 'var(--warn)' : 'var(--success)';
        renewalHTML = `<div style="margin-top:15px;padding:10px;border:1px solid ${color};color:${color};font-weight:bold;text-align:center;background:rgba(0,0,0,0.5)">
            ${daysLeft > 0 ? daysLeft + ' DAYS LEFT TO RENEW' : 'SUBSCRIPTION EXPIRED'}
        </div>`;
    }

    // 3. Logic: Hiding Cards based on Tier
    if (tier !== 'Guest') {
        let message = '';
        let badgeColor = 'var(--neon)';

        if(tier === 'Standard') {
            if(sCard) sCard.style.display = 'none'; // Hide Standard
            message = `
                <div class="perk-check">
                    <div class="perk-item"><span>✓</span> Gym Floor Access</div>
                    <div class="perk-item"><span>✓</span> Standard Lockers</div>
                    <div class="perk-item"><span>✓</span> Group Sessions</div>
                </div>
                <p style="margin-top:15px; font-size:0.7rem; opacity:0.6;">Upgrade below to unlock Recovery Suite.</p>`;
        } 
        else if(tier === 'Premium') {
            if(sCard) sCard.style.display = 'none'; // Hide Standard
            if(pCard) pCard.style.display = 'none'; // Hide Premium
            message = `
                <div class="perk-check">
                    <div class="perk-item"><span>✓</span> 24/7 Access</div>
                    <div class="perk-item"><span>✓</span> Cryo & Sauna</div>
                    <div class="perk-item"><span>✓</span> Recovery Pods</div>
                </div>
                <p style="margin-top:15px; font-size:0.7rem; opacity:0.6;">One step away from Elite status.</p>`;
        } 
        else if(tier === 'Elite' || tier === 'Admin') {
            // Hide ALL cards for Elite/Admin
            if(sCard) sCard.style.display = 'none'; 
            if(pCard) pCard.style.display = 'none'; 
            if(eCard) eCard.style.display = 'none';
            
            badgeColor = 'var(--gold)';
            message = `
                <h3 style="color:var(--gold); margin-bottom: 10px;">MAXIMUM POTENTIAL REACHED</h3>
                <p style="margin-bottom:20px;">You have successfully ascended to the apex of RAAYA LIFTS.</p>
                <div class="perk-check" style="justify-content:center;">
                    <div class="perk-item"><span>★</span> VIP Private Bay</div>
                    <div class="perk-item"><span>★</span> AI Performance Coach</div>
                    <div class="perk-item"><span>★</span> Unlimited Guest Passes</div>
                    <div class="perk-item"><span>★</span> 24/7 Priority Access</div>
                </div>`;
        }

        box.innerHTML = `
            <div class="current-plan-box" style="border-color:${badgeColor}; text-align: ${tier === 'Elite' || tier === 'Admin' ? 'center' : 'left'}">
                ${tier !== 'Elite' && tier !== 'Admin' ? `<h3 style="color:${badgeColor}">ACTIVE PROTOCOL: ${tier.toUpperCase()}</h3>` : ''}
                ${message}
                ${renewalHTML}
            </div>`;
    }
}

async function fetchUserProfile() {
    if (!user) return;
    const { data } = await sb.from('profiles').select('*').eq('id', user.id).maybeSingle();
    
    if (data) {
        const urlParams = new URLSearchParams(window.location.search);
        const isPreview = urlParams.get('mode') === 'preview';

        if ((data.is_admin === true || data.membership_tier === 'Admin') && !isPreview) {
            window.location.href = 'admin.html';
            return;
        }

        if(isPreview && (data.is_admin || data.membership_tier === 'Admin')) {
            if(!document.getElementById('adminReturnBtn')) {
                const badge = document.getElementById('userBadge');
                badge.innerHTML += `<a id="adminReturnBtn" href="admin.html" style="background:var(--neon);color:#000;padding:2px 5px;font-size:0.6rem;text-decoration:none;margin-left:10px;font-weight:700">RETURN TO BASE</a>`;
            }
        }

        user.profile = data;
        document.getElementById('portalBtn').style.display = 'none';
        document.getElementById('userBadge').style.display = 'flex';
        document.getElementById('cartBtn').style.display = 'block';
        document.getElementById('logoutBtn').style.display = 'block';
        document.getElementById('userNameDisplay').innerText = data.full_name || "PLAYER";
        
        const tier = data.membership_tier ? data.membership_tier.toUpperCase() : "GUEST";
        document.getElementById('userTierDisplay').innerText = tier;
        
        let daysLeft = null;
        // FIXED: FETCH FOR EVERYONE EXCEPT GUEST (EVEN ADMINS NEED IT)
        if(tier !== 'GUEST') {
            const { data: sale } = await sb.from('sales_ledger')
                .select('created_at')
                .eq('user_id', user.id)
                .eq('category', 'Membership')
                .order('created_at', { ascending: false })
                .limit(1)
                .maybeSingle(); 
            
            if(sale) {
                const start = new Date(sale.created_at);
                const now = new Date();
                const diffTime = Math.abs(now - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                daysLeft = 30 - diffDays; 
            }
        }

        updateMembershipUI(data.membership_tier || "Guest", daysLeft);
        
        if (tier === 'GUEST') {
            document.getElementById('userTierDisplay').className = ""; 
            if(document.getElementById('upgradeBadge')) document.getElementById('upgradeBadge').style.display = 'inline-block';
        } else {
            document.getElementById('userTierDisplay').className = tier === 'ELITE' ? 'gold-shimmer' : 'shimmer-text';
            if(document.getElementById('upgradeBadge')) document.getElementById('upgradeBadge').style.display = 'none';
        }
    }
}

// --- INIT ---
(async function init() {
    const { data: { session } } = await sb.auth.getSession();
    if (session) {
        user = session.user;
        await fetchUserProfile();
    }
    await loadMembershipTiers();
    await loadFacilities();
    await loadVaultProducts();
})();

sb.auth.onAuthStateChange((event, session) => {
    if (event === 'SIGNED_IN' && session) { user = session.user; fetchUserProfile(); }
    else if (event === 'SIGNED_OUT') { user = null; window.location.reload(); }
});

async function loadMembershipTiers() {
    const { data: tiers } = await sb.from('membership_tiers').select('*').order('price');
    if(!tiers || tiers.length === 0) return;
    
    const grid = document.getElementById('membershipGrid');
    if(grid) grid.innerHTML = ''; 
    
    tiers.forEach(t => {
        const feats = t.features.map(f => `<li>${f}</li>`).join('');
        const style = t.name === 'Premium' ? 'border-color:var(--neon);background:var(--glass)' : '';
        
        grid.innerHTML += `
            <div class="mem-card" id="card-${t.name.toLowerCase()}" style="${style}">
                <h3>${t.name}</h3>
                <div class="price">₹${t.price}<span style="font-size:.9rem">/mo</span></div>
                <ul class="mem-features">${feats}</ul>
                <button class="btn" onclick="buyMembership('${t.name}', ${t.price})">INITIATE</button>
            </div>
        `;
    });

    // CRITICAL FIX: Re-apply UI logic now that cards exist in the DOM
    if(user && user.profile) {
        // We pass the tier, but null for daysLeft to avoid overwriting the badge (fetchUserProfile handles the badge)
        // However, to ensure cards are hidden correctly, we access the styles directly here as a failsafe:
        const tier = user.profile.membership_tier;
        const sCard = document.getElementById('card-standard');
        const pCard = document.getElementById('card-premium');
        const eCard = document.getElementById('card-elite');

        if(tier === 'Standard' && sCard) sCard.style.display = 'none';
        if(tier === 'Premium') {
            if(sCard) sCard.style.display = 'none';
            if(pCard) pCard.style.display = 'none';
        }
        if(tier === 'Elite' || tier === 'Admin') {
            if(sCard) sCard.style.display = 'none';
            if(pCard) pCard.style.display = 'none';
            if(eCard) eCard.style.display = 'none';
        }
    }
}

async function loadFacilities() {
    const { data: facilities } = await sb.from('facilities').select('*');
    if(!facilities || facilities.length === 0) return;
    const wrapper = document.getElementById('facilityWrapper');
    if(wrapper) wrapper.innerHTML = '';
    facilities.forEach(f => {
        wrapper.innerHTML += `<div class="facility-card" style="background-image: url('${f.image_url}')"><div class="f-overlay"><div class="f-title">${f.name}</div><div class="f-desc">${f.description}</div></div></div>`;
    });
}

async function loadVaultProducts() {
    const { data: allProds } = await sb.from('vault_products').select('*');
    if(!allProds) return;
    products = { supplements:[], gear:[], apparel:[] };
    allProds.forEach(p => {
        if(products[p.category]) products[p.category].push({
            name: p.name,
            price: `₹${p.price}`,
            img: p.image_url
        });
    });
    renderCarousel();
}

let currentCat='supplements',currentIdx=0,carousel=document.getElementById('vaultCarousel'),theta=0;
function rotateCarousel(){const angle=theta*currentIdx*-1;carousel.style.transform=`translateZ(-288px) rotateY(${angle}deg)`}
function renderCarousel(){
    const items=products[currentCat];
    if(!items || items.length === 0) { carousel.innerHTML = '<div style="text-align:center;padding:20px">NO INTEL FOUND</div>'; return; }
    const cellCount=items.length;
    theta=360/cellCount;
    const cellSize=260; 
    const radius=Math.round((cellSize/2)/Math.tan(Math.PI/cellCount));
    carousel.innerHTML='';
    items.forEach((p,i)=>{
        const cell=document.createElement('div');
        cell.className='vault-card';
        cell.style.transform=`rotateY(${i*theta}deg) translateZ(${radius+50}px)`;
        cell.innerHTML=`<div class="vault-img" style="background-image:url('${p.img}')"></div><h3>${p.name}</h3><div class="price-tag">${p.price}</div><button class="btn" onclick="addToCart('${p.name}', ${parseInt(p.price.replace(/[^\d]/g,''))})">ACQUIRE</button>`;
        carousel.appendChild(cell);
    });
    rotateCarousel();
}
document.querySelectorAll('.cat-btn').forEach(btn=>{btn.onclick=()=>{document.querySelector('.cat-btn.active').classList.remove('active');btn.classList.add('active');currentCat=btn.dataset.cat;currentIdx=0;renderCarousel()}})
document.getElementById('prevBtn').onclick=()=>{currentIdx--;rotateCarousel()};document.getElementById('nextBtn').onclick=()=>{currentIdx++;rotateCarousel()}

document.getElementById('authBtn').onclick = async () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('pass').value;
    if(!email || !password) return;

    if (isSignUp) {
        if (document.getElementById('pwdText').innerText !== 'STRONG') { showMsg("SECURITY","Password too weak."); return; }
        const nameVal = document.getElementById('suName').value || "";
        const ageVal = document.getElementById('suAge').value;
        const phoneVal = document.getElementById('suPhone').value || "";
        const { data, error } = await sb.auth.signUp({ email, password, options: { data: { full_name: nameVal, age: ageVal, phone: phoneVal } } });
        if (error) { showMsg("ERROR", error.message); } 
        else { 
            const formData = new FormData(); formData.append('_subject', 'NEW AGENT: '+nameVal); formData.append('name', nameVal); formData.append('email', email); formData.append('phone', phoneVal);
            fetch("https://formspree.io/f/xgvnrrrv", { method: "POST", body: formData, headers: { 'Accept': 'application/json' } });
            showMsg("PROTOCOL INITIATED", "Identity created. Verify email."); closeAuth(); 
        }
    } else {
        const { data, error } = await sb.auth.signInWithPassword({ email, password });
        if (error) showMsg("DENIED", error.message);
        else { user = data.user; closeAuth(); await fetchUserProfile(); }
    }
}

window.openAuth=()=>{document.getElementById('authModal').style.display='grid'}
window.closeAuth=()=>{document.getElementById('authModal').style.display='none'}
document.getElementById('toggleAuth').onclick=()=>{
    isSignUp=!isSignUp;
    document.getElementById('mTitle').innerText=isSignUp?'CREATE ACCOUNT':'LOGIN';
    document.getElementById('authBtn').innerText=isSignUp?'SIGN UP':'LOGIN';
    document.getElementById('toggleAuth').innerText=isSignUp?'Have account? Login':'New here? Create Account';
    document.getElementById('signupFields').style.display=isSignUp?'block':'none';
    document.getElementById('pwdMeter').style.display=isSignUp?'flex':'none';
}
window.checkStrength=(p)=>{if(!isSignUp)return;let s=0;if(p.length>9)s++;if(/[A-Z]/.test(p))s++;if(/[0-9]/.test(p))s++;if(/[^A-Za-z0-9]/.test(p))s++;const bar=document.getElementById('pwdBar'),txt=document.getElementById('pwdText');if(s<2){bar.style.width='30%';bar.style.background='red';txt.innerText='WEAK'}else if(s<4){bar.style.width='60%';bar.style.background='orange';txt.innerText='MODERATE'}else{bar.style.width='100%';bar.style.background='#00ff88';txt.innerText='STRONG'}}
function showMsg(t,b){document.getElementById('msgTitle').innerText=t;document.getElementById('msgBody').innerText=b;document.getElementById('msgModal').style.display='grid'}
window.handleLogout=async()=>{await sb.auth.signOut(); user=null; window.location.reload();}

window.buyMembership = (tier, price) => { if (!user) { openAuth(); return; } pendingMembership = tier; document.getElementById('payModal').style.display='grid'; document.getElementById('payForm').style.display='block'; document.getElementById('tracker').style.display='none'; }
window.addToCart=(n,p)=>{ if(!user){openAuth();return} cart.push({name:n,price:p}); document.getElementById('cartCount').innerText=cart.length; showMsg("ACQUIRED",`${n} added.`); }
window.openCart=()=>{ const c=document.getElementById('cartItems'); c.innerHTML=''; let t=0; cart.forEach(i=>{t+=i.price; c.innerHTML+=`<div class="cart-item"><span>${i.name}</span><span>₹${i.price}</span></div>`}); document.getElementById('cartTotal').innerText=`₹${t}`; document.getElementById('cartModal').style.display='grid'; }
window.openPay=()=>{ if(cart.length===0)return; pendingMembership=null; document.getElementById('cartModal').style.display='none'; document.getElementById('payModal').style.display='grid'; document.getElementById('payForm').style.display='block'; document.getElementById('tracker').style.display='none'; }
window.processPay = async () => {
    document.getElementById('payForm').style.display = 'none';
    const userName = user?.profile?.full_name || user?.email || "Unknown Agent";
    
    // 1. MEMBERSHIP PURCHASE LOGIC
    if (pendingMembership) {
        // Update DB
        await sb.from('profiles').update({ membership_tier: pendingMembership }).eq('id', user.id);
        let price = pendingMembership === 'Standard' ? 999 : pendingMembership === 'Premium' ? 1999 : 2499;
        await sb.from('sales_ledger').insert([{ user_id: user.id, user_name: userName, item_name: pendingMembership + " Membership", category: "Membership", amount: price }]);
        
        // --- FORMSPREE ALERT START ---
        const formData = new FormData();
        formData.append('_subject', 'NEW SALE: ' + pendingMembership + ' Membership');
        formData.append('Agent Name', userName);
        formData.append('Item Purchased', pendingMembership + " Membership");
        formData.append('Amount Paid', "₹" + price);
        
        fetch("https://formspree.io/f/xgvnrrrv", { 
            method: "POST", 
            body: formData, 
            headers: { 'Accept': 'application/json' } 
        }).catch(err => console.error("Alert Error:", err));
        // --- FORMSPREE ALERT END ---

        showMsg("UPGRADE COMPLETE", `Welcome to the ${pendingMembership} Tier.`);
        await fetchUserProfile();
        document.getElementById('payModal').style.display = 'none';
    
    // 2. PRODUCT CART LOGIC
    } else {
        if(cart.length > 0) {
            // Save to DB
            const salesData = cart.map(item => ({ user_id: user.id, user_name: userName, item_name: item.name, category: "Product", amount: item.price }));
            await sb.from('sales_ledger').insert(salesData);

            // --- FORMSPREE ALERT START ---
            const formData = new FormData();
            const itemList = cart.map(i => `${i.name} (₹${i.price})`).join(', ');
            const totalAmount = cart.reduce((sum, item) => sum + item.price, 0);

            formData.append('_subject', 'NEW SALE: Product Order');
            formData.append('Agent Name', userName);
            formData.append('Items', itemList);
            formData.append('Total Value', "₹" + totalAmount);

            fetch("https://formspree.io/f/xgvnrrrv", { 
                method: "POST", 
                body: formData, 
                headers: { 'Accept': 'application/json' } 
            }).catch(err => console.error("Alert Error:", err));
            // --- FORMSPREE ALERT END ---
        }
        document.getElementById('tracker').style.display = 'block';
        cart = []; 
        document.getElementById('cartCount').innerText = 0; 
    }
}
document.getElementById('contactForm').onsubmit=async(e)=>{
    e.preventDefault(); const f=new FormData(e.target); const obj=Object.fromEntries(f);
    await sb.from('contact_messages').insert([obj]);
    fetch("https://formspree.io/f/xgvnrrrv",{method:"POST",body:f,headers:{'Accept':'application/json'}});
    showMsg("SENT","Message encrypted & transmitted."); e.target.reset();
}

function animateStats() {
    if(statsRun) return; statsRun = true;
    let ob=0; const obEl=document.getElementById('count-obesity'); const obT=setInterval(()=>{if(ob>=39){clearInterval(obT)}else{ob++;obEl.innerText=ob+'%'}},40);
    let car=0; const carEl=document.getElementById('count-cardiac'); const carT=setInterval(()=>{if(car>=17.9){clearInterval(carT)}else{car+=0.5;carEl.innerText=car.toFixed(1)+'M'}},30);
    const sedEl=document.getElementById('count-sedentary'); const stages=['Low','Medium','Risky','High']; let si=0; const sedT=setInterval(()=>{if(si>=3){clearInterval(sedT)}else{si++;sedEl.innerText=stages[si]}},400);
}
const obs = new IntersectionObserver(e => { e.forEach(x => { if (x.isIntersecting) { x.target.classList.add('active'); if(x.target.id === 'crisis') setTimeout(animateStats, 1500); } }) }, {threshold: 0.2});
document.querySelectorAll('.reveal').forEach(el => obs.observe(el));
obs.observe(document.getElementById('crisis'));
</script>
</body>
</html>
}